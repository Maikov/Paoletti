<!-- *********************************************************************************** -->
<!-- *** Part of OpenShop project: http://OpenShop.org.ua (c) MaxD                   *** -->
<!-- *********************************************************************************** -->
<!-- Redistribution in any form without written permission is prohibited.                -->

<modification>
	<id><![CDATA[Turns on image compression for autogenerated images (without quality loss). Avoids image recompession when the size is the same. Fixes Image Manager to automatically submit uploaded image.]]></id>
	<version><![CDATA[1.2]]></version>
	<vqmver><![CDATA[]]></vqmver>
	<author><![CDATA[MaxD http://FileShop.Biz]]></author>

	<!-- Start of image manager autosubmit fix -->

	<file name="admin/view/template/common/filemanager.tpl">
		<operation error="skip">
			<search position="replace" offset="6"><![CDATA[onComplete: function(file, json) {]]></search>
			<add><![CDATA[        onComplete: function(file, json) {
            if (json.success) {
                var tree = $.tree.focused();

                tree.select_branch(tree.selected);
                // MX Start
                var path = $(tree.selected).attr('directory');
                if((path.length>0) && (path.charAt(path.length-1) != '/')){path+='/'}
                var path = path+ file;
                <?php if ($fckeditor) { ?>
                    window.opener.CKEDITOR.tools.callFunction(<?php echo $fckeditor; ?>, '<?php echo $directory; ?>' + path);

                    self.close();
                <?php } else { ?>
                    parent.$('#<?php echo $field; ?>').attr('value', 'data/'+path);
                    parent.$('#dialog').dialog('close');

                    parent.$('#dialog').remove();
                <?php } ?>
                // MX End]]></add>
		</operation>
		<operation error="skip">
			<search position="before" offset="7"><![CDATA[$('#column-right a').live('click', function() {]]></search>
			<add><![CDATA[/* MX]]></add>
		</operation>
		<operation error="skip">
			<search position="before" offset="6"><![CDATA[$('#column-right a').live('click', function() {]]></search>
			<add><![CDATA[*/]]></add>
		</operation>
	</file>

	<!-- End of image manager autosubmit fix -->


	<!-- Start of image manager image size limitation fix -->

	<file name="admin/controller/common/filemanager.php">
		<operation error="skip">
			<search position="replace"><![CDATA[$json['error'] = $this->language->get('error_file_size');]]></search>
			<add><![CDATA[// MX Patch  $json['error'] = $this->language->get('error_file_size');]]></add>
		</operation>
	</file>

	<!-- End of image manager image size limitation fix -->

</modification>